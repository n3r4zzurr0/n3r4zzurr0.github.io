<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta charset="utf-8">
  <title>video-frames demo - n3r4zzurr0.in</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.3/beautify.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/default.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/a11y-dark.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
  <script src="/static/videoframes.min.js"></script>
  <style>*{scrollbar-width:thin;scrollbar-color:#666 #14151a}body{margin:0;font-family:monospace;background-color:#1f2028;color:#fff}::-webkit-scrollbar{width:10px;height:10px}::-webkit-scrollbar-track{background:#14151a}::-webkit-scrollbar-thumb{background:#666}::-webkit-scrollbar-thumb:hover{background:#999}input,select{font-family:monospace;background-color:#000;color:#fff;border:0;height:30px;border-radius:4px;width:100%;padding:0}input[type=text]{text-indent:6px}input[type=file],input[type=file]::file-selector-button{font-size:12px}button,input[type=file],input[type=file]::file-selector-button,select{font-family:monospace;cursor:pointer;border-radius:4px}input[type=file]::file-selector-button{background-color:#2196f3;color:#fff;border:0;height:30px;margin-right:12px}pre{margin:0}.hljs{background-color:#14151a}.page-title{display:table;margin:30px auto 0;font-weight:700;font-size:30px}.quick-links{display:table;margin:18px auto 45px;font-size:15px;font-weight:700;color:#aaa}.page-title a{text-decoration:none;color:#39a1f4}.quick-links a{text-decoration:none;color:#0d8aee}.page-title a:hover,.quick-links a:hover{text-decoration:underline}.container{display:flex;justify-content:space-between;width:calc(100vw - 48px);max-width:1024px;margin:30px auto 60px}.or{text-align:center;margin:12px 0}.mb-24{margin-bottom:24px}.input-box{display:flex;margin-bottom:12px}.input-box .label{width:120px;line-height:30px}.input-box .input{width:calc(100% - 120px)}.container .left{width:390px}.container .left .box{padding:18px;border-radius:4px;background-color:#14151a}.title{font-weight:700;margin-bottom:18px}#console{margin-bottom:18px}#extract{width:100%;height:30px;margin-top:18px;background-color:#2196f3;color:#fff;border:0;font-weight:700}#extract:disabled{opacity:.5;cursor:not-allowed}#thumbnails{height:300px;overflow:auto}.container .right{width:calc(100% - 420px);overflow-x:auto}@media only screen and (max-width:900px){.container .left{width:360px}.container .right{width:calc(100% - 384px)}}@media only screen and (max-width:768px){.container{display:block}.container .left,.container .right{width:100%}.container .right{margin-top:60px}#thumbnails{height:auto}}</style>
</head>
<body>
  <div class="page-title"><a href="https://www.npmjs.com/package/video-frames" target="_blank">video-frames</a> demo</div>
  <div class="quick-links">
    <a target="_blank" href="https://www.npmjs.com/package/video-frames">npm</a> / <a target="_blank" href="https://github.com/n3r4zzurr0/video-frames">github</a> / <a target="_blank" href="https://n3r4zzurr0.in/static/videoframes.min.js">minified js</a> / <a target="_blank" href="https://codepen.io/n3r4zzurr0/pen/abqOXpQ?editors=1010">codepen</a>
  </div>
  <div class="container">
    <div class="left">
      <div class="box">
        <div class="input-box" style="margin:0">
          <div class="label">Choose Video</div>
          <div class="input"><input id="file-input" type="file" accept="video/x-matroska,video/mp4,video/webm,video/quicktime" /></div>
        </div>
      </div>
      <div class="or">or</div>
      <div class="box">
        <div class="input-box" style="margin:0">
          <div class="label">Video URL</div>
          <div class="input"><input id="url-input" type="text" spellcheck="false" placeholder="https://" /></div>
        </div>
      </div>
      <div class="mb-24"></div>
      <div class="title">Image Options</div>
      <div class="box">
        <div class="input-box">
          <div class="label">Width (px)</div>
          <div class="input"><input id="width-input" type="text" spellcheck="false" placeholder="128" /></div>
        </div>
        <div class="input-box">
          <div class="label">Height (px)</div>
          <div class="input"><input id="height-input" type="text" spellcheck="false" placeholder="auto" /></div>
        </div>
        <div class="input-box" style="margin:0">
          <div class="label">Format</div>
          <div class="input">
            <select id="format-input">
              <option selected>image/png</option>
              <option>image/jpeg</option>
              <option>image/webp</option>
            </select>
          </div>
        </div>
      </div>
      <div class="mb-24"></div>
      <div class="title">Video Options</div>
      <div class="box">
        <div class="input-box">
          <div class="label">Start Time (s)</div>
          <div class="input"><input id="start-time-input" type="text" spellcheck="false" placeholder="0" /></div>
        </div>
        <div class="input-box">
          <div class="label">End Time (s)</div>
          <div class="input"><input id="end-time-input" type="text" spellcheck="false" placeholder="Video Duration" /></div>
        </div>
        <div class="input-box" style="margin:0">
          <div class="label">Count</div>
          <div class="input"><input id="count-input" type="text" spellcheck="false" placeholder="1" /></div>
        </div>
      </div>
      <div class="or">or</div>
      <div class="box">
        <div class="input-box" style="margin:0">
          <div class="label">Offsets (s)<br /><span style="font-size:12px;">(comma sep.)</span></div>
          <div class="input"><input id="offsets-input" type="text" spellcheck="false" placeholder="0,1,2" /></div>
        </div>
      </div>
      <button id="extract">Extract</button>
    </div>
    <div class="right">
      <pre><code class="language-js">var i = 1;console.log(i);</code></pre>
      <div class="title" style="margin-top:30px">Extracted Frames</div>
      <div id="console">...</div>
      <div id="thumbnails"></div>
    </div>
  </div>

  <script>
  const App = {
    options: {
      url: null,
      width: null,
      height: null,
      format: null,
      startTime: null,
      endTime: null,
      count: null,
      offsets: null,
      onLoad: () => { console.log('video loaded'); App.loaded() },
      onProgress: (framesExtracted, totalFrames) => { console.log(`${framesExtracted} of ${totalFrames} frames extracted`); App.progress(framesExtracted, totalFrames) }
    },
    start: function() {
      this.urlInput = document.getElementById('url-input');
      this.fileInput = document.getElementById('file-input');
      this.widthInput = document.getElementById('width-input');
      this.heightInput = document.getElementById('height-input');
      this.formatInput = document.getElementById('format-input');
      this.startTimeInput = document.getElementById('start-time-input');
      this.endTimeInput = document.getElementById('end-time-input');
      this.countInput = document.getElementById('count-input');
      this.offsetsInput = document.getElementById('offsets-input');
      this.extractBtn = document.getElementById('extract');
      this.console = document.getElementById('console');
      this.thumbnails = document.getElementById('thumbnails');
      this.code = document.getElementsByClassName('right')[0].getElementsByTagName('code')[0];

      this.writeCode();
      this.listen();
    },
    listen: function() {
      this.fileInput.oninput = (e) => {
        this.options.url = URL.createObjectURL(e.target.files[0]);
        this.writeCode();
      };
      this.urlInput.oninput = (e) => { this.writeInput('url', e.target.value); }
      this.widthInput.oninput = (e) => { this.writeInput('width', e.target.value); this.checkWidthHeight(); }
      this.heightInput.oninput = (e) => { this.writeInput('height', e.target.value); this.checkWidthHeight(); }
      this.formatInput.oninput = (e) => {
        this.options.format = e.target.value/* === 'image/png' ? null : e.target.value*/;
        this.writeCode();
      };
      this.startTimeInput.oninput = (e) => { this.writeInput('startTime', e.target.value); }
      this.endTimeInput.oninput = (e) => { this.writeInput('endTime', e.target.value); }
      this.countInput.oninput = (e) => { this.writeInput('count', e.target.value); }
      this.offsetsInput.oninput = (e) => { 
        if(e.target.value)
          this.options.offsets = e.target.value.split(',');
        else
          this.options.offsets = null;
        this.writeCode();
      };
      this.extractBtn.onclick = () => { this.extract(); };
    },
    checkWidthHeight: function() {
      if(!this.options.width && this.options.height)
        this.widthInput.setAttribute('placeholder', 'auto');
      else
        this.widthInput.setAttribute('placeholder', '128');
    },
    writeInput: function(prop, value) {
      this.options[prop] = value;
      this.writeCode();
    },
    writeCode: function() {
      let code = '';
      code += 'videoFrames({';
      for(prop in this.options)
        if(this.options[prop]) {
          if(prop === 'url' || prop === 'format')
            code += `${prop}: '${this.options[prop].toString()}',`;
          else if(prop === 'offsets')
            code += `${prop}: [${this.options[prop].join(', ')}],`;
          else if(prop === 'onLoad')
            code += `${prop}: ${this.options[prop].toString().replace('; App.loaded()', '')},`;
          else if(prop === 'onProgress')
            code += `${prop}: ${this.options[prop].toString().replace('; App.progress(framesExtracted, totalFrames)', '')},`;
          else
            code += `${prop}: ${this.options[prop].toString()},`;
        }
      code += '}).then((frames) => { console.log(frames) })';
      this.code.innerHTML = js_beautify(code);
      hljs.highlightAll();
    },
    extract: function() {
      this.extractBtn.setAttribute('disabled', '');
      videoFrames({...this.options}).then((frames) => {
        console.log(frames);
        this.extractBtn.removeAttribute('disabled');
        if(frames.length > 0) {
          this.thumbnails.innerHTML = '';
          frames.forEach(f => {
            this.thumbnails.innerHTML += `<img src="${f.image}" />`;
          });
        } else
          this.console.innerHTML = 'error (check console)';
      });
    },
    loaded: function() {
      this.console.innerHTML = `video loaded`;
    },
    progress: function(f, t) {
      this.console.innerHTML = `${f} of ${t} frames extracted`;
    }
  };
  window.onload = () => {
    App.start();
  };
  </script>
</body>
</html>
